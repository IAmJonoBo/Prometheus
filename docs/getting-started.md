# Getting Started with Prometheus Development

This guide walks you through setting up an optimized local development environment for Prometheus, including LFS and wheelhouse configuration for air-gapped development.

**Prerequisites**: macOS, Linux, or WSL2 on Windows with Python 3.11+  
**Estimated Time**: 15-20 minutes

For project overview, see [README](../README.md) or [Current Status](../CURRENT_STATUS.md).

## Quick Start

Run the development optimization script:

```bash
./scripts/setup-dev-optimized.sh
```

## Metadata Cleanup

The setup script now prunes common macOS metadata artefacts (for example,
`.DS_Store`, `._*`, `.AppleDouble`) before kicking off the rest of the workflow.
It calls `scripts/cleanup-macos-cruft.sh --include-git --include-poetry-env`
so the repository, `.git` metadata, and the active Poetry virtual environment
are all scrubbed. Re-run the cleanup at any time with:

```bash
scripts/cleanup-macos-cruft.sh --include-poetry-env
```

Use `--extra-path PATH` if you keep additional virtual environments or working
directories outside the repository that need the same treatment.

## LFS Optimization

The repository uses Git LFS for large binary files. The optimization script configures:

- Batch transfers for better performance
- Appropriate timeouts for large files
- Concurrent transfers (8 parallel)
- Local caching optimization

### Useful LFS Commands

```bash
# Check LFS status
git lfs-status

# Check for unhydrated files
git lfs-check

# Fetch all LFS objects
git lfs-fetch-all

# Verify LFS setup
scripts/ci/verify-lfs.sh
```

## Pre-commit Guardrails

The setup script installs a `.git/hooks/pre-commit` hook (sourced from
`.githooks/pre-commit`) that applies the formatting-and-check pipeline
before every commit:

- Removes macOS metadata artefacts (e.g., `.DS_Store`, `.AppleDouble`, `Icon?`)
  across the repository and any active Poetry virtual environment, then
  re-stages cleaned files.
- Runs `poetry run python scripts/format_yaml.py --staged` so YAML diffs stay
  formatter-clean and schema-validated.
- Lints staged Python files with `poetry run ruff check`, keeping the VS Code
  Problems pane and CI in sync.
- Emits warnings for staged files larger than 10 MB so you can move them into
  Git LFS.

If you prefer repository-managed hooks, run

```bash
git config core.hooksPath .githooks
```

to have Git execute the tracked hook scripts directly.

## Wheelhouse for Offline Development

The wheelhouse contains pre-downloaded Python packages for offline development:

```bash
# Build wheelhouse with default extras
git wheelhouse

# Build with specific extras
EXTRAS="pii,rag,llm" git wheelhouse

# Install from wheelhouse
pip install --no-index --find-links wheelhouse -r vendor/wheelhouse/requirements.txt
```

## Environment Variables

Key environment variables for development:

- `EXTRAS`: Comma-separated list of Poetry extras to include (default: pii)
- `PARALLEL_JOBS`: Number of parallel jobs for builds (default: CPU count)
- `OPTIMIZE_LFS`: Enable LFS optimization (default: true)
- `BUILD_WHEELHOUSE`: Build wheelhouse during setup (default: true)

## Air-Gapped Development

For development without internet access:

1. Run the setup script with network access first
2. Ensure all LFS files are hydrated: `git lfs fetch --all && git lfs checkout`
3. Build a complete wheelhouse:
   `INCLUDE_DEV=true EXTRAS="all-extras" ./scripts/build-wheelhouse.sh`
4. Archive the vendor directory for transfer:
   `tar -czf prometheus-vendor.tar.gz vendor/`

## Troubleshooting

### LFS Issues

- **Unhydrated files**: Run `git lfs fetch --all && git lfs checkout`
- **Slow LFS operations**: Check network connection and LFS server status
- **Missing LFS objects**: Ensure they exist on the remote with
  `git lfs ls-files --all`

### Wheelhouse Issues

- **Missing wheels**: Rebuild with `./scripts/build-wheelhouse.sh`
- **Platform mismatch**: Check that wheels match your platform architecture
- **Dependency conflicts**: Update Poetry lock file and rebuild

Generated by setup-dev-optimized.sh on Thu Oct 2 2025
