# Development Setup for Prometheus

This document describes the optimized development setup for the Prometheus repository,
including LFS and wheelhouse configuration for air-gapped development.

## Quick Start

Run the development optimization script:

```bash
./scripts/setup-dev-optimized.sh
```

## LFS Optimization

The repository uses Git LFS for large binary files. The optimization script configures:

- Batch transfers for better performance
- Appropriate timeouts for large files
- Concurrent transfers (8 parallel)
- Local caching optimization

### Useful LFS Commands

```bash
# Check LFS status
git lfs-status

# Check for unhydrated files
git lfs-check

# Fetch all LFS objects
git lfs-fetch-all

# Verify LFS setup
scripts/ci/verify-lfs.sh
```

## Pre-commit Guardrails

The setup script installs a `.git/hooks/pre-commit` hook that removes
macOS metadata files (for example, `.DS_Store`, `.AppleDouble`, `Icon?`)
before each commit and restages the cleanup. The hook also surfaces
warnings for staged files larger than 10 MB so you can move them into
Git LFS.

## Wheelhouse for Offline Development

The wheelhouse contains pre-downloaded Python packages for offline development:

```bash
# Build wheelhouse with default extras
git wheelhouse

# Build with specific extras
EXTRAS="pii,rag,llm" git wheelhouse

# Install from wheelhouse
pip install --no-index --find-links wheelhouse -r vendor/wheelhouse/requirements.txt
```

## Environment Variables

Key environment variables for development:

- `EXTRAS`: Comma-separated list of Poetry extras to include (default: pii)
- `PARALLEL_JOBS`: Number of parallel jobs for builds (default: CPU count)
- `OPTIMIZE_LFS`: Enable LFS optimization (default: true)
- `BUILD_WHEELHOUSE`: Build wheelhouse during setup (default: true)

## Air-Gapped Development

For development without internet access:

1. Run the setup script with network access first
2. Ensure all LFS files are hydrated: `git lfs fetch --all && git lfs checkout`
3. Build a complete wheelhouse: `INCLUDE_DEV=true EXTRAS="all-extras" ./scripts/build-wheelhouse.sh`
4. Archive the vendor directory for transfer: `tar -czf prometheus-vendor.tar.gz vendor/`

## Troubleshooting

### LFS Issues

- **Unhydrated files**: Run `git lfs fetch --all && git lfs checkout`
- **Slow LFS operations**: Check network connection and LFS server status
- **Missing LFS objects**: Ensure they exist on the remote with `git lfs ls-files --all`

### Wheelhouse Issues

- **Missing wheels**: Rebuild with `./scripts/build-wheelhouse.sh`
- **Platform mismatch**: Check that wheels match your platform architecture
- **Dependency conflicts**: Update Poetry lock file and rebuild

Generated by setup-dev-optimized.sh on Wed Oct 1 06:11:08 SAST 2025
